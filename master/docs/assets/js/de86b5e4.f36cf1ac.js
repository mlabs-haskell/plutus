"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3832],{9777:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>h});var n=s(4848),i=s(8453);const a={sidebar_position:20},o="Common weaknesses",r={id:"reference/common-weaknesses",title:"Common weaknesses",description:'This section provides a listing of common weaknesses in Plutus applications. "Weakness" is used in the sense of the Common Weakness Enumeration, as a potential source of vulnerabilities in applications.',source:"@site/docs/reference/common-weaknesses.md",sourceDirName:"reference",slug:"/reference/common-weaknesses",permalink:"/plutus/master/docs/reference/common-weaknesses",draft:!1,unlisted:!1,editUrl:"https://github.com/IntersectMBO/plutus/edit/master/docusaurus/docs/reference/common-weaknesses.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{sidebar_position:20},sidebar:"tutorialSidebar",previous:{title:"Examples",permalink:"/plutus/master/docs/reference/examples"},next:{title:"Plutus language changes",permalink:"/plutus/master/docs/reference/plutus-language-changes"}},l={},h=[{value:"Double satisfaction",id:"double-satisfaction",level:2},{value:"What is going wrong here?",id:"what-is-going-wrong-here",level:3},{value:"Risks",id:"risks",level:3},{value:"Solutions",id:"solutions",level:3},{value:"Hard limits",id:"hard-limits",level:2},{value:"Risks",id:"risks-1",level:3},{value:"Solutions",id:"solutions-1",level:3}];function c(e){const t={a:"a",blockquote:"blockquote",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"common-weaknesses",children:"Common weaknesses"}),"\n",(0,n.jsxs)(t.p,{children:["This section provides a listing of common ",(0,n.jsx)(t.em,{children:"weaknesses"}),' in Plutus applications. "Weakness" is used in the sense of the ',(0,n.jsx)(t.a,{href:"https://cwe.mitre.org/",children:"Common Weakness Enumeration"}),", as a potential source of vulnerabilities in applications."]}),"\n",(0,n.jsx)(t.h2,{id:"double-satisfaction",children:"Double satisfaction"}),"\n",(0,n.jsx)(t.p,{children:'Suppose we have a validator V that implements a typical "atomic swap" or "escrowed swap" between A and B where A goes first, i.e. V says:'}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"This output can only be spent if, in the same transaction, there is an output sending the agreed-upon payment (encoded in the output's datum) to A."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Now suppose that A and B have two swaps in progress, one for a token T1 at the price of 10 Ada, and one for a token T2 at the same price.\nThat means that there will exist two outputs, both locked by V."}),"\n",(0,n.jsx)(t.p,{children:"Now B constructs a transaction which spends both outputs, and creates one output addressed to A with 10 Ada (taking T1 and T2 for himself)."}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.img,{alt:"Double satisfaction",src:s(4004).A+"",width:"980",height:"740"}),"\n",(0,n.jsx)(t.em,{children:"A diagram showing the transaction setup for the double satisfaction of two swaps."})]}),"\n",(0,n.jsxs)(t.p,{children:["A naive implementation of V will just check that the transaction has ",(0,n.jsx)(t.em,{children:"an"}),' output to A with 10 Ada in it, and then be satisfied.\nBut this allows B to "double satisfy" the two validators, because they will both see the same output and be satisfied.\nThe end result is that B can get away with paying only 10 Ada to A, even though B\'s true liability to A is 20 Ada.']}),"\n",(0,n.jsx)(t.h3,{id:"what-is-going-wrong-here",children:"What is going wrong here?"}),"\n",(0,n.jsx)(t.p,{children:"It is difficult to say exactly what is going wrong here.\nNeither validator's expectations are explicitly being violated."}),"\n",(0,n.jsxs)(t.p,{children:["One way of looking at it is that this is a consequence of the fact that validators only ",(0,n.jsx)(t.em,{children:"validate"}),", rather than ",(0,n.jsx)(t.em,{children:"doing"})," things.\nIn a model like Ethereum's, where smart contracts ",(0,n.jsx)(t.em,{children:"make transfers"}),", then two smart contracts would simply make two transfers, and there would be no problem.\nBut in the EUTXO model all a validator can do is try to ascertain whether its wishes have been carried out, which in this case is ambiguous."]}),"\n",(0,n.jsx)(t.p,{children:"Following this metaphor, we can see how the same problem could arise in the real world.\nSuppose that two tax auditors from two different departments come to visit you in turn to see if you've paid your taxes.\nYou come up with a clever scheme to confuse them.\nYour tax liability to both departments is $10, so you make a single payment to the tax office's bank account for $10.\nWhen the auditors arrive, you show them your books, containing the payment to the tax office.\nThey both leave satisfied."}),"\n",(0,n.jsxs)(t.p,{children:["How do we solve this problem in the real world?\nWell, the two tax offices might have different bank accounts, but more likely they would simply require you to use two different payment references.\nThat way, the payment that each auditor expect to see is unique, so they know it's for them.\nWe can do something similar in the EUTXO model.\nSee the section on ",(0,n.jsx)(t.a,{href:"#unique-outputs",children:"Unique outputs"})," below."]}),"\n",(0,n.jsx)(t.h3,{id:"risks",children:"Risks"}),"\n",(0,n.jsx)(t.p,{children:"This is a serious problem for many kinds of application.\nAny application that makes payments to specific parties needs to ensure that those payments are correctly identified and don't overlap with other payments."}),"\n",(0,n.jsx)(t.h3,{id:"solutions",children:"Solutions"}),"\n",(0,n.jsx)(t.p,{children:"It's possible that a solution will be developed that makes this weakness easier to avoid.\nIn the mean time, there are workarounds that developers can use."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Unique outputs"})}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"The simplest workaround is to ensure that the outputs which your scripts care about are unique.\nThis prevents them being confused with other outputs."}),"\n",(0,n.jsx)(t.p,{children:"In the swap example, if A had used a different key hashes as their payment addresses in each, then one output could not have satisfied both validators, since each one would want an output addressed to a different key hash."}),"\n",(0,n.jsx)(t.p,{children:'It is not too difficult to use unique outputs.\nFor payments to users, wallets typically already generate unique key hashes for every payment received.\nFor payments to script addresses it is a bit more complicated, and applications may wish to include the equivalent of a "payment reference" in the datum to keep things unique.'}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Ban other scripts"})}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"A more draconian workaround is for your script to insist that it runs in a transaction which is running no other scripts, so there is no risk of confusion.\nNote that it is not enough to consider just validator scripts, minting and reward scripts must also be banned."}),"\n",(0,n.jsx)(t.p,{children:"However, this prevents even benign usage of multiple scripts in one transaction, which stops people from designing interesting interactions, and may force users to break up transactions unnecessarily."}),"\n",(0,n.jsx)(t.h2,{id:"hard-limits",children:"Hard limits"}),"\n",(0,n.jsx)(t.p,{children:"Many resources on Cardano are limited in some fashion.\nAt a high level, limits can be enforced in two ways:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.em,{children:"Hard limits"}),": these are limits which cannot be breached. Typically, these are implemented with specific thresholds, where exceeding the threshold causes a hard failure."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.em,{children:"Soft limits"}),": these are limits which ",(0,n.jsx)(t.em,{children:"can"})," be breached, but where there is a significant disincentive to do so. One way of implementing a soft limit is to have sharply increasing costs to using the resource beyond the soft limit."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Hard limits are clear, easy to specify, and provide hard guarantees for the protocol, but they have the disadvantage that there is no way to evade the limit.\nThis means that there is a discontinuity at the limit: beforehand you can always do more by paying more, but after the limit there is nothing you can do."}),"\n",(0,n.jsx)(t.p,{children:"Currently, these resources on Cardano have hard limits:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Transaction size"}),"\n",(0,n.jsx)(t.li,{children:"Block size"}),"\n",(0,n.jsx)(t.li,{children:"UTXO size"}),"\n",(0,n.jsx)(t.li,{children:"Script execution units"}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["If an application ",(0,n.jsx)(t.em,{children:"requires"})," a transaction that exceeds one of these limits, then the application will be stuck unless the limit is increased or removed.\nThis is most common when scripts are involved, since a script can require a very particular shape of transaction, regardless of whether this exceeds limits."]}),"\n",(0,n.jsx)(t.p,{children:"Examples:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"A script requires providing a datum which is extremely large and exceeds the transaction size limit."}),"\n",(0,n.jsx)(t.li,{children:"A script which locks an output needs more execution units than the limit."}),"\n",(0,n.jsx)(t.li,{children:"A script requires creating a single output containing a very large amount of tokens, which exceeds the output size limit."}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"risks-1",children:"Risks"}),"\n",(0,n.jsx)(t.p,{children:"This is typically an issue for applications that work with user-supplied data, or data that can grow in an unbounded way over time.\nThis can result in data which itself becomes large, or which requires a large amount of resources to process."}),"\n",(0,n.jsx)(t.p,{children:"For example:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Managing an arbitrary collection of assets (unbounded over time)."}),"\n",(0,n.jsx)(t.li,{children:"Allowing user-specified payloads in datums (user-supplied unbounded data)."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Script size should not itself be a risk (since scripts and their sizes should generally be known ahead of time), but large scripts can reduce the amount of space available for other uses, heightening the risk of hitting a limit."}),"\n",(0,n.jsx)(t.h3,{id:"solutions-1",children:"Solutions"}),"\n",(0,n.jsx)(t.p,{children:"In the long run, hard limits may be increased, removed, or turned into soft limits."}),"\n",(0,n.jsx)(t.p,{children:"In the mean time, there are some approaches that developers can use to reduce the risk."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Careful testing"})}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"It is important to test as many of the execution paths of your application as possible.\nThis is important for correctness, but also to ensure that there are not unexpected cases where script resource usage spikes."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Bounding data usage"})}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Carefully consider whether your application may rely on unbounded data, and try to avoid that.\nFor example, if your application needs to manage a large quantity of assets, try to split them across multiple UTXOs instead of relying on a single UTXO to hold them all."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Providing datums when creating outputs"})}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Datum size issues are most likely to be discovered when an output is spent, because the datum is provided only as a hash on the output.\nInsisting that the datum is provided in the transaction that creates the output can reveal that it is too big earlier in the process, allowing another path to be taken.\nDepending on the application, this may still prevent it from progressing, if there is only one way to move forwards."}),"\n",(0,n.jsxs)(t.p,{children:["If ",(0,n.jsx)(t.a,{href:"https://cips.cardano.org/cips/cip32/",children:"CIP-32"})," is implemented, this can be done conveniently by using inline datums, although that also risks hitting the output size limit."]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.strong,{children:"Reducing script size costs through reference inputs"})}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["If ",(0,n.jsx)(t.a,{href:"https://cips.cardano.org/cips/cip33/",children:"CIP-33"})," is implemented, then the contribution of scripts to transaction size can be massively reduced by using a reference script instead of including the entire script."]})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},4004:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/double-satisfaction-cc2503bfc93e83f2375a16b648c4f151.png"},8453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>r});var n=s(6540);const i={},a=n.createContext(i);function o(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);